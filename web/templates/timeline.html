{% extends 'base.html' %}

{% block title %}Timeline{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<link rel="stylesheet" href="/static/styles/timeline.css">
{% endblock %}

{% block extra_styles %}
{# CSS moved to /static/styles/timeline.css #}
{% endblock %}

{% block content %}
        <div class="timeline-wrapper">
            <div class="timeline-layout">
            <div class="calendar-panel">
                <div class="month-selector">
                    <div class="view-toggle">
                        <button class="view-btn active" id="viewMonth" data-view="month">Month</button>
                        <button class="view-btn" id="viewWeek" data-view="week">Week</button>
                    </div>
                    <button id="prevMonth" title="Previous month (H key)">‚Üê</button>
                    <div class="month-display" id="monthDisplay">Loading...</div>
                    <button id="nextMonth" title="Next month (L key)">‚Üí</button>
                </div>

                <div class="calendar-header">
                    <a href="#" id="todayNav" class="today-link">
                        <svg class="nav-icon" viewBox="0 0 24 24">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                            <line x1="10" y1="14" x2="14" y2="14"></line>
                        </svg>
                        Go to Today
                    </a>
                </div>
                <div class="calendar-weekdays">
                    <div class="weekday">Sun</div>
                    <div class="weekday">Mon</div>
                    <div class="weekday">Tue</div>
                    <div class="weekday">Wed</div>
                    <div class="weekday">Thu</div>
                    <div class="weekday">Fri</div>
                    <div class="weekday">Sat</div>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <div class="loading">
                        <div class="spinner"></div>
                        <div>Loading calendar...</div>
                    </div>
                </div>
                <div class="calendar-legend">
                    <span>Less</span>
                    <div class="legend-item" style="background: var(--intensity-0);"></div>
                    <div class="legend-item" style="background: var(--intensity-1);"></div>
                    <div class="legend-item" style="background: var(--intensity-2);"></div>
                    <div class="legend-item" style="background: var(--intensity-3);"></div>
                    <div class="legend-item" style="background: var(--intensity-4);"></div>
                    <span>More</span>
                    <span class="info-icon">?
                        <span class="info-tooltip">Activity intensity is based on the number of screenshots captured. Darker colors indicate more activity. Screenshots are taken every 30 seconds when you're active.</span>
                    </span>
                </div>

                <!-- Week View Panel (hidden by default) -->
                <div id="weekViewPanel" class="week-view-panel" style="display: none;">
                    <div class="week-days-strip" id="weekDaysStrip"></div>
                </div>

                <div id="leftChartSection" style="display: none; margin-top: 20px;">
                    <h2>Hourly Activity</h2>
                    <div class="detail-stats" id="detailStats"></div>
                    <div class="chart-container" style="margin-top: 15px;">
                        <canvas id="hourlyChart"></canvas>
                    </div>
                    <div id="tagsSection" class="tags-section" style="display: none;">
                        <h3>Tags</h3>
                        <div id="tagsList" class="tags-list"></div>
                    </div>
                </div>
            </div>

            <div class="detail-panel">
                <div class="detail-header">
                    <div class="date-selector">
                        <button id="prevDayBtn" title="Previous day">‚Üê</button>
                        <h2 id="selectedDate">Select a day</h2>
                        <button id="nextDayBtn" title="Next day">‚Üí</button>
                        <input type="date" id="datePickerInput" class="date-picker-input"
                               title="Jump to date" aria-label="Jump to specific date">
                    </div>
                </div>

                <div id="detailContent" class="detail-content-wrapper">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÖ</div>
                        <p>Click a day on the calendar to view activity</p>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>

    <div class="keyboard-hint">
        <kbd>‚Üê</kbd> <kbd>‚Üí</kbd> <kbd>‚Üë</kbd> <kbd>‚Üì</kbd> Navigate days
        <span style="margin: 0 10px;">|</span>
        <kbd>H</kbd> Prev month <kbd>L</kbd> Next month
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-hidden="true">
        <h2 id="modalTitle" class="sr-only">Screenshot Viewer</h2>
        <button class="modal-close" aria-label="Close screenshot viewer">&times;</button>
        <div class="modal-content">
            <button class="modal-nav modal-nav-prev" id="modalPrev" aria-label="Previous screenshot">‚Üê</button>
            <img id="modalImage" class="modal-image" alt="Full size screenshot">
            <button class="modal-nav modal-nav-next" id="modalNext" aria-label="Next screenshot">‚Üí</button>
        </div>
        <div class="modal-info">
            <div class="modal-metadata">
                <div class="modal-meta-item">
                    <span class="modal-meta-label">Counter</span>
                    <span class="modal-meta-value modal-counter" id="modalCounter">1 / 1</span>
                </div>
                <div class="modal-meta-item">
                    <span class="modal-meta-label">Time</span>
                    <span class="modal-meta-value" id="modalTime">--:--:--</span>
                </div>
                <div class="modal-meta-item">
                    <span class="modal-meta-label">Application</span>
                    <span class="modal-meta-value" id="modalApp">Unknown</span>
                </div>
                <div class="modal-meta-item" id="modalWindowTitleContainer" style="display: none;">
                    <span class="modal-meta-label">Window Title</span>
                    <span class="modal-meta-value" id="modalWindowTitle">--</span>
                </div>
            </div>
            <div class="modal-shortcuts">
                <span class="shortcut-key">&larr;</span> / <span class="shortcut-key">&rarr;</span> Navigate
                &nbsp;&nbsp;|&nbsp;&nbsp;
                <span class="shortcut-key">Esc</span> Close
            </div>
            <a href="#" class="modal-view-all-link" id="modalViewAllLink">View all screenshots from this day ‚Üí</a>
        </div>
    </div>
{% endblock %}

{% block extra_scripts %}
<script src="/static/js/timeline.js"></script>
{% endblock %}
