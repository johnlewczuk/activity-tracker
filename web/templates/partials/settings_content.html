{# Settings content partial with tabs - used for drawer #}
{# Requires settings.css to be loaded #}

<link rel="stylesheet" href="/static/styles/settings.css">

<!-- Pure CSS Tabs using radio buttons -->
<div class="settings-tabs-container">
    <!-- Hidden radio inputs for tab state -->
    <input type="radio" name="settings-tab" id="tab-radio-capture" class="tab-radio" checked>
    <input type="radio" name="settings-tab" id="tab-radio-ai" class="tab-radio">
    <input type="radio" name="settings-tab" id="tab-radio-data" class="tab-radio">
    <input type="radio" name="settings-tab" id="tab-radio-system" class="tab-radio">

    <!-- Tab Navigation (labels for radio buttons) -->
    <div class="drawer-tabs" role="tablist">
        <label for="tab-radio-capture" class="drawer-tab" role="tab">
            <svg class="tab-icon" viewBox="0 0 24 24">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                <circle cx="12" cy="13" r="4"></circle>
            </svg>
            <span>Capture</span>
        </label>
        <label for="tab-radio-ai" class="drawer-tab" role="tab">
            <svg class="tab-icon" viewBox="0 0 24 24">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </svg>
            <span>AI</span>
        </label>
        <label for="tab-radio-data" class="drawer-tab" role="tab">
            <svg class="tab-icon" viewBox="0 0 24 24">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                <line x1="12" y1="22.08" x2="12" y2="12"></line>
            </svg>
            <span>Data</span>
        </label>
        <label for="tab-radio-system" class="drawer-tab" role="tab">
            <svg class="tab-icon" viewBox="0 0 24 24">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
            </svg>
            <span>System</span>
        </label>
    </div>

    <!-- Tab Content -->
    <div class="settings-tabs-content">
        <!-- Capture Tab (Capture + AFK + Goals) -->
        <div id="tab-capture" class="drawer-tab-content" role="tabpanel">
        <div class="settings-grid">
            <!-- Capture Settings -->
            <div class="settings-section">
                <h2>
                    <svg class="section-icon" viewBox="0 0 24 24">
                        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                        <circle cx="12" cy="13" r="4"></circle>
                    </svg>
                    Capture
                </h2>

                <div class="settings-row">
                    <div class="settings-label">
                        <h3>Interval</h3>
                        <p>Time between screenshots</p>
                        <span class="restart-notice">Requires restart</span>
                    </div>
                    <div class="settings-control">
                        <input type="range" id="interval_seconds" min="10" max="120" step="10">
                        <span class="slider-value"><span id="interval_seconds_value">30</span>s</span>
                    </div>
                </div>

                <div class="settings-row">
                    <div class="settings-label">
                        <h3>Format</h3>
                        <p>Screenshot file format</p>
                    </div>
                    <div class="settings-control">
                        <select id="format">
                            <option value="webp">WebP (recommended)</option>
                            <option value="png">PNG</option>
                            <option value="jpg">JPEG</option>
                        </select>
                    </div>
                </div>

                <div class="settings-row">
                    <div class="settings-label">
                        <h3>Quality</h3>
                        <p>Compression quality</p>
                    </div>
                    <div class="settings-control">
                        <input type="range" id="quality" min="50" max="100" step="5">
                        <span class="slider-value"><span id="quality_value">80</span>%</span>
                    </div>
                </div>

                <div class="settings-row">
                    <div class="settings-label">
                        <h3>Active Monitor Only</h3>
                        <p>Only capture focused monitor</p>
                    </div>
                    <div class="settings-control">
                        <label class="toggle">
                            <input type="checkbox" id="capture_active_monitor_only">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- AFK Detection -->
            <div class="settings-section">
                <h2>
                    <svg class="section-icon" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    AFK Detection
                </h2>

                <div class="settings-row">
                    <div class="settings-label">
                        <h3>Timeout</h3>
                        <p>Inactivity before marking AFK</p>
                        <span class="restart-notice">Requires restart</span>
                    </div>
                    <div class="settings-control">
                        <input type="range" id="timeout_seconds" min="60" max="600" step="30">
                        <span class="slider-value"><span id="timeout_seconds_value">180</span>s</span>
                    </div>
                </div>

                <div class="settings-row">
                    <div class="settings-label">
                        <h3>Min Session Length</h3>
                        <p>Minimum session duration to keep</p>
                    </div>
                    <div class="settings-control">
                        <input type="range" id="min_session_minutes" min="1" max="30" step="1">
                        <span class="slider-value"><span id="min_session_minutes_value">5</span>m</span>
                    </div>
                </div>
            </div>

            <!-- Goals -->
            <div class="settings-section">
                <h2>
                    <svg class="section-icon" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M12 16v-4"></path>
                        <path d="M12 8h.01"></path>
                    </svg>
                    Goals
                </h2>

                <div class="settings-row">
                    <div class="settings-label">
                        <h3>Daily Work Hours</h3>
                        <p>Target work hours per day</p>
                    </div>
                    <div class="settings-control">
                        <input type="range" id="daily_work_hours" min="1" max="16" step="0.5">
                        <span class="slider-value"><span id="daily_work_hours_value">8</span>h</span>
                    </div>
                </div>

                <div class="settings-row">
                    <div class="settings-label">
                        <h3>Weekday Goals Only</h3>
                        <p>Only show goal percentage on Mon-Fri</p>
                    </div>
                    <div class="settings-control">
                        <label class="toggle">
                            <input type="checkbox" id="weekday_goals_only" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Tab (Summarization) -->
    <div id="tab-ai" class="drawer-tab-content" role="tabpanel">
        <div class="settings-grid">
            <div class="settings-section">
                <h2>
                    <svg class="section-icon" viewBox="0 0 24 24">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>
                    AI Summarization
                </h2>

                <!-- Enable Toggle -->
                <div class="settings-row">
                    <div class="settings-label">
                        <h3>Enable Summarization</h3>
                        <p>Automatically generate activity summaries</p>
                    </div>
                    <div class="settings-control">
                        <label class="toggle">
                            <input type="checkbox" id="summarization_enabled">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Model Selection -->
                <div class="settings-row">
                    <div class="settings-label">
                        <h3>Model</h3>
                        <p>AI model for analysis</p>
                    </div>
                    <div class="settings-control">
                        <select id="model">
                            <option value="">Loading models...</option>
                        </select>
                        <button type="button" class="refresh-btn" id="refreshModelsBtn" title="Refresh models list">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 4 23 10 17 10"></polyline>
                                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Summary Frequency -->
                <div class="settings-row">
                    <div class="settings-label">
                        <h3>Summary Frequency</h3>
                        <p>How often to generate summaries</p>
                    </div>
                    <div class="settings-control">
                        <select id="frequency_minutes">
                            <option value="5">Every 5 minutes</option>
                            <option value="15">Every 15 minutes</option>
                            <option value="30">Every 30 minutes</option>
                            <option value="60">Every hour</option>
                        </select>
                    </div>
                </div>

                <!-- Summary Quality Preset -->
                <div class="settings-row">
                    <div class="settings-label">
                        <h3>Summary Quality</h3>
                        <p>Quick = faster, Thorough = more detailed</p>
                    </div>
                    <div class="settings-control">
                        <select id="quality_preset">
                            <option value="quick">Quick</option>
                            <option value="balanced">Balanced</option>
                            <option value="thorough">Thorough</option>
                        </select>
                    </div>
                </div>

                <!-- Content Mode -->
                <div class="settings-row column">
                    <div class="settings-label">
                        <h3>Content to Include</h3>
                        <p>What information to send to the AI</p>
                    </div>
                    <div class="content-mode-checkboxes">
                        <label class="checkbox-label">
                            <input type="checkbox" id="include_focus_context" checked>
                            <span class="checkbox-text">
                                <strong>App/window usage breakdown</strong>
                                <small>Time spent per app</small>
                            </span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="include_screenshots" checked>
                            <span class="checkbox-text">
                                <strong>Screenshots</strong>
                                <small>Visual context of your screen</small>
                            </span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="include_ocr" checked>
                            <span class="checkbox-text">
                                <strong>OCR text</strong>
                                <small>Text extracted from screenshots</small>
                            </span>
                        </label>
                    </div>
                </div>

                <!-- Advanced Settings (Collapsible) -->
                <div class="advanced-settings-toggle" id="advancedToggle">
                    <svg id="advancedArrow" class="collapse-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                    <span>Advanced Settings</span>
                </div>

                <div id="advancedSettings" class="advanced-settings collapsed">
                    <div class="settings-row">
                        <div class="settings-label">
                            <h3>Ollama Host</h3>
                            <p>API endpoint URL</p>
                        </div>
                        <div class="settings-control">
                            <input type="text" id="ollama_host" placeholder="http://localhost:11434">
                        </div>
                    </div>

                    <div class="settings-row">
                        <div class="settings-label">
                            <h3>Crop to Window</h3>
                            <p>Focus on active window only</p>
                        </div>
                        <div class="settings-control">
                            <label class="toggle">
                                <input type="checkbox" id="crop_to_window">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="underlying-settings">
                        <div class="underlying-header">
                            <span>Settings from Quality Preset</span>
                            <span class="preset-badge" id="currentPresetBadge">balanced</span>
                        </div>

                        <div class="settings-row compact">
                            <div class="settings-label">
                                <h3>Max Screenshots</h3>
                            </div>
                            <div class="settings-control">
                                <input type="range" id="max_samples" min="3" max="20" step="1">
                                <span class="slider-value"><span id="max_samples_value">10</span></span>
                            </div>
                        </div>

                        <div class="settings-row compact">
                            <div class="settings-label">
                                <h3>Include Previous Context</h3>
                            </div>
                            <div class="settings-control">
                                <label class="toggle">
                                    <input type="checkbox" id="include_previous_summary">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="settings-row compact">
                            <div class="settings-label">
                                <h3>Focus-Weighted Sampling</h3>
                            </div>
                            <div class="settings-control">
                                <label class="toggle">
                                    <input type="checkbox" id="focus_weighted_sampling">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="settings-row compact">
                            <div class="settings-label">
                                <h3>Trigger Threshold</h3>
                                <p class="computed-note">Computed from frequency</p>
                            </div>
                            <div class="settings-control">
                                <span class="computed-value" id="trigger_threshold_display">30 screenshots</span>
                            </div>
                        </div>
                    </div>

                    <div class="prompt-preview-section">
                        <div class="prompt-preview-header">
                            <h3>Prompt Template</h3>
                            <button type="button" class="secondary small" id="promptPreviewToggle">
                                <span id="promptToggleText">Show</span>
                            </button>
                        </div>
                        <div id="promptPreview" class="prompt-preview collapsed">
                            <pre id="promptTemplateText">Loading prompt template...</pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Tab (Storage + Privacy + Tags) -->
    <div id="tab-data" class="drawer-tab-content" role="tabpanel">
        <div class="settings-grid">
            <!-- Storage -->
            <div class="settings-section">
                <h2>
                    <svg class="section-icon" viewBox="0 0 24 24">
                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                        <line x1="12" y1="22.08" x2="12" y2="12"></line>
                    </svg>
                    Storage
                </h2>

                <div class="settings-row">
                    <div class="settings-label">
                        <h3>Data Directory</h3>
                        <p>Location for screenshots</p>
                    </div>
                    <div class="settings-control">
                        <input type="text" id="data_dir" readonly style="opacity: 0.7; cursor: not-allowed;">
                    </div>
                </div>

                <div class="settings-row">
                    <div class="settings-label">
                        <h3>Retention Period</h3>
                        <p>Delete older data (0 = unlimited)</p>
                    </div>
                    <div class="settings-control">
                        <input type="range" id="max_days_retention" min="0" max="365" step="30">
                        <span class="slider-value"><span id="max_days_retention_value">90</span>d</span>
                    </div>
                </div>

                <div class="settings-row">
                    <div class="settings-label">
                        <h3>Max Storage</h3>
                        <p>Storage limit (0 = unlimited)</p>
                    </div>
                    <div class="settings-control">
                        <input type="range" id="max_gb_storage" min="0" max="200" step="10">
                        <span class="slider-value"><span id="max_gb_storage_value">50</span>GB</span>
                    </div>
                </div>

                <div class="settings-row column">
                    <div class="settings-label">
                        <h3>Current Usage</h3>
                    </div>
                    <div class="storage-info">
                        <div class="storage-text">
                            <span class="storage-used"><span id="storage_used">0</span> GB used</span>
                            <span class="storage-max"><span id="storage_max">50</span> GB limit</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="storage_progress" style="width: 0%;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Privacy -->
            <div class="settings-section">
                <h2>
                    <svg class="section-icon" viewBox="0 0 24 24">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                    Privacy
                </h2>

                <div class="settings-row column">
                    <div class="settings-label">
                        <h3>Excluded Apps</h3>
                        <p>Apps to exclude from tracking (press Enter to add)</p>
                    </div>
                    <div id="excluded_apps_container" class="tag-input-container">
                        <input type="text" class="tag-input" id="excluded_apps_input" placeholder="Type app name and press Enter...">
                    </div>
                </div>
            </div>

            <!-- Tag Management -->
            <div class="settings-section">
                <h2>
                    <svg class="section-icon" viewBox="0 0 24 24">
                        <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                        <line x1="7" y1="7" x2="7.01" y2="7"></line>
                    </svg>
                    Tag Management
                    <span class="stat-value" style="margin-left: auto; font-weight: normal; font-size: 0.85rem;">
                        <span id="uniqueTagCount">-</span> tags
                    </span>
                </h2>

                <div class="settings-row column">
                    <div class="settings-label">
                        <h3>Merge Tags</h3>
                        <p>Click tags below to select, then merge into a single tag</p>
                    </div>

                    <div class="tag-search-row">
                        <input type="text" id="tagSearchInput" placeholder="Filter tags...">
                        <button type="button" class="secondary small" id="analyzeTagsBtn" title="Find duplicate tags automatically">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                            </svg>
                            Find Duplicates
                        </button>
                    </div>

                    <div id="tagCloud" class="tag-cloud">
                        <span class="loading-text">Loading tags...</span>
                    </div>

                    <div id="mergeControls" class="merge-controls" style="display: none;">
                        <div class="merge-info">
                            <span id="selectedTagsCount">0</span> tags selected
                            <button type="button" class="text-btn" id="clearTagsBtn">Clear</button>
                        </div>
                        <div class="merge-input-row">
                            <label for="canonicalTagInput">Merge into:</label>
                            <input type="text" id="canonicalTagInput" placeholder="canonical-tag-name">
                            <button type="button" id="mergeTagsBtn">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"></path>
                                </svg>
                                Merge
                            </button>
                        </div>
                    </div>
                </div>

                <div id="tagConsolidationResults" class="tag-consolidation-results" style="display: none;">
                    <div class="consolidation-header">
                        <h4>Suggested Duplicates</h4>
                        <span class="select-all-toggle">
                            <label>
                                <input type="checkbox" id="selectAllConsolidations">
                                Select All
                            </label>
                        </span>
                    </div>
                    <div id="consolidationList" class="consolidation-list"></div>
                    <div class="consolidation-actions">
                        <button type="button" id="applyConsolidationsBtn" disabled>
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            Apply Selected
                        </button>
                        <button type="button" class="secondary" id="cancelConsolidationBtn">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Tab (Status) -->
    <div id="tab-system" class="drawer-tab-content" role="tabpanel">
        <div class="settings-grid">
            <div class="settings-section">
                <h2>
                    <svg class="section-icon" viewBox="0 0 24 24">
                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                    </svg>
                    System Status
                </h2>

                <div class="settings-row">
                    <div class="settings-label">
                        <h3>Ollama</h3>
                        <p>AI summarization service</p>
                    </div>
                    <div class="settings-control">
                        <span class="status-badge" id="ollama_status">Checking...</span>
                    </div>
                </div>

                <div class="settings-row">
                    <div class="settings-label">
                        <h3>Screenshots</h3>
                        <p>Total captured</p>
                    </div>
                    <div class="settings-control">
                        <span class="stat-value" id="screenshot_count">-</span>
                    </div>
                </div>

                <div class="settings-row column">
                    <div class="settings-label">
                        <h3>Monitors</h3>
                        <p>Detected displays</p>
                    </div>
                    <ul class="monitor-list" id="monitor_list"></ul>
                </div>
            </div>

            <!-- Actions in System tab -->
            <div class="settings-section" id="actionsSection">
                <h2>
                    <svg class="section-icon" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    Actions
                </h2>

                <div id="unsavedIndicator" class="unsaved-banner hidden">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    <span>You have unsaved changes</span>
                </div>

                <div class="actions-row" id="saveActions">
                    <button id="saveBtn">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                            <polyline points="7 3 7 8 15 8"></polyline>
                        </svg>
                        Save
                    </button>
                    <button class="restart-btn" id="saveRestartBtn">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"></polyline>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                        </svg>
                        Save &amp; Restart
                    </button>
                    <button class="secondary" id="discardBtn">Discard</button>
                </div>

                <hr class="actions-divider">

                <div class="actions-row">
                    <button class="secondary" id="exportConfigBtn">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Export
                    </button>
                    <button class="danger" id="resetConfigBtn">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 6h18"></path>
                            <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                            <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                        </svg>
                        Reset
                    </button>
                </div>
            </div>
        </div>
    </div>
    </div>
</div>

<!-- Floating Save Reminder -->
<div id="saveBar" class="save-bar hidden">
    <div class="save-bar-content">
        <span class="unsaved-indicator">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            Unsaved changes
        </span>
        <div class="save-buttons">
            <button id="floatingSaveBtn">Save</button>
            <button class="restart-btn" id="floatingSaveRestartBtn" style="display: none;">Save &amp; Restart</button>
        </div>
    </div>
</div>

<!-- Toast Notification -->
<div id="toast" class="toast"></div>
