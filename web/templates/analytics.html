{% extends "base.html" %}

{% block title %}Analytics Dashboard - Activity Tracker{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<link rel="stylesheet" href="/static/styles/analytics.css">
{% endblock %}

{% block extra_styles %}
{# CSS moved to /static/styles/analytics.css #}
{% endblock %}

{% block content %}
<div class="controls">
    <div class="date-range-selector">
        <button class="range-btn active" data-range="7">Last 7 days</button>
        <button class="range-btn" data-range="14">Last 14 days</button>
        <button class="range-btn" data-range="30">Last 30 days</button>
    </div>
    <button class="refresh-btn" id="refreshBtn">Refresh</button>
</div>

<!-- AI Insights Section -->
<h2 class="section-header">
    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
    AI Insights
</h2>

<div class="summary-cards" id="aiSummaryCards">
    <div class="card">
        <div class="card-title">Total Summaries</div>
        <div class="card-value" id="totalSummaries">-</div>
        <div class="card-subtitle">Generated in period</div>
    </div>
    <div class="card">
        <div class="card-title">Avg Confidence</div>
        <div class="card-value" id="avgConfidence">-</div>
        <div class="card-subtitle">Model certainty</div>
    </div>
    <div class="card">
        <div class="card-title">High Confidence</div>
        <div class="card-value success" id="highConfCount">-</div>
        <div class="card-subtitle">Reliable summaries</div>
    </div>
    <div class="card">
        <div class="card-title">Unique Tags</div>
        <div class="card-value" id="uniqueTags">-</div>
        <div class="card-subtitle">Activity categories</div>
    </div>
</div>

<!-- Tag Cloud and Confidence Distribution -->
<div class="chart-row">
    <div class="chart-panel">
        <h3>Activity Tags</h3>
        <div class="tag-cloud" id="tagCloud">
            <div class="no-data">Loading tags...</div>
        </div>
    </div>
    <div class="chart-panel">
        <h3 id="confidenceChartLabel">Confidence Distribution</h3>
        <div class="chart-container">
            <canvas id="confidenceChart" role="img" aria-labelledby="confidenceChartLabel" aria-describedby="confidenceChartDesc"></canvas>
            <p id="confidenceChartDesc" class="sr-only">Pie chart showing distribution of AI summary confidence levels</p>
        </div>
    </div>
</div>

<!-- Recent AI Summaries -->
<div class="chart-panel" style="margin-bottom: 30px;">
    <h3>Recent AI Summaries</h3>
    <ul class="summary-list" id="recentSummaries">
        <li class="no-data">Loading summaries...</li>
    </ul>
</div>

<!-- Focus Tracking Section -->
<h2 class="section-header">
    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
    Focus Tracking (Today)
</h2>

<div class="metrics-row" id="focusMetrics">
    <div class="metric-card">
        <div class="metric-value" id="trackedTime">-</div>
        <div class="metric-label">Tracked Time</div>
    </div>
    <div class="metric-card">
        <div class="metric-value" id="contextSwitches">-</div>
        <div class="metric-label">Context Switches</div>
    </div>
    <div class="metric-card">
        <div class="metric-value" id="longestFocus">-</div>
        <div class="metric-label">Longest Focus</div>
    </div>
    <div class="metric-card">
        <div class="metric-value" id="appsUsed">-</div>
        <div class="metric-label">Apps Used</div>
    </div>
</div>

<div class="chart-panel" style="margin-bottom: 20px;">
    <h3 id="focusTimelineLabel">Focus Timeline</h3>
    <div class="focus-timeline" id="focusTimeline" role="img" aria-labelledby="focusTimelineLabel" aria-describedby="focusTimelineDesc"></div>
    <p id="focusTimelineDesc" class="sr-only">Visual timeline showing application usage throughout the day</p>
    <div class="timeline-legend" id="focusLegend"></div>
</div>

<!-- App Usage Section -->
<div class="chart-row">
    <div class="chart-panel">
        <h3 id="appUsageChartLabel">Top Applications</h3>
        <div class="chart-container">
            <canvas id="appUsageChart" role="img" aria-labelledby="appUsageChartLabel" aria-describedby="appUsageChartDesc"></canvas>
            <p id="appUsageChartDesc" class="sr-only">Doughnut chart showing time spent in each application</p>
        </div>
    </div>
    <div class="chart-panel">
        <h3>App Usage Breakdown</h3>
        <div style="max-height: 280px; overflow-y: auto;">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Application</th>
                        <th style="text-align: right;">Time</th>
                        <th style="width: 35%;">Usage</th>
                    </tr>
                </thead>
                <tbody id="appTableBody">
                    <tr><td colspan="3" class="no-data">Loading...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Activity Trend -->
<div class="chart-panel" style="margin-top: 20px;">
    <h3 id="trendChartLabel">Summary Generation Trend</h3>
    <div class="chart-container">
        <canvas id="trendChart" role="img" aria-labelledby="trendChartLabel" aria-describedby="trendChartDesc"></canvas>
        <p id="trendChartDesc" class="sr-only">Bar chart showing number of AI summaries generated per day</p>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="/static/js/analytics.js"></script>
{% endblock %}
